---
layout: post
title: 데이터 파이프라인 핵심 가이드 정리(9장) 
---

#  데이터 파이프라인 핵심 가이드

01. 데이터 파이프라인 소개
02. 최신 데이터 인프라
03. 일반적인 데이터 파이프라인 패턴
04. 데이터 수집: 데이터 추출
05. 데이터 수집: 데이터 로드
06. 데이터 변환하기
07. 파이프라인 오케스트레이션
08. 파이프라인 데이터 검증
09. 파이프라인 유지 관리 모범 사례
10.  파이프라인 성능 측정 및 모니터링 


## 09. 파이프라인 유지 관리 모범 사례
* 이 장에서는 복잡성이 증가하고 시스템의 불가피한 변화에 대처할때 파이프라인을 유지 관리하는 방법에 대해 설명한다.

### 소스 시스템의 변경 사항 처리
* 개발자들은 기능 추가 / 리펙토링 / 버그 수정 등으로 항상 소프트웨어를 변경한다. 이런 변경으로 수집한 데이터의 스키마 또는 의미가 수정되면 파이프라인이 실패하거나 부정확해질 위험이 있다. 
* 데이터 인프라는 매우 다양한 소스에서 수집되기 때문에 소스 시스템에서의 변경을 눈치채기 쉽지 않다.

#### 추상화 도입
* 소스 시스템과 수집 프로세스 사이에 추상화 계층을 도입하는 것이 가장 좋다.

#### 데이터 계약 유지 관리
* 소스 시스템의 소유자와 데이터 파이프라인에서 사용하기 위해 데이터를 수집하는 팀 간의 서면 계약이다. 
* 추출방법(전체, 증분), 배치 기간(일단위, 월단위 등), 담당자 연락처를 명시한다. 
* 텍스트 문서 형태로 작성 가능하지만 표준화 된 형태로 json 파일을 사용하여 명시하기도 한다. 

#### Schema-on-Read의 고려사항
* 데이터 레이크, S3 버킷 또는 기타 스토리지 시스템에 기록되는 패턴이다. 
* 이 패턴은 스토리지에 데이터를 쓰는 데는 매우 효율적이지만 로드 단계에서 복잡성을 추가하고 파이프라인에서 몇 가지 주요 의미를 갖는다.
* 실용적으로 사용하고 사람이 참조할 수 있도록 카탈로그에 데이터 구조를 정의하고 저장하는 것이 중요하다. (Glue 데이터 카탈로그 등)
* 스카마 변경을 동적으로 처리하는 방법을 고려해야 한다. (수집 중에 새 필드가 탐지되면 DW 새 열을 동적으로 추가할 것인지 등)

### 확장 복잡성
* 파이프라인 단계에서 수행하는 몇 가지 팁과 모범 사례를 살펴보자.

####데이터 수집 표준화
* 복잡성과 관련해서 각 시스템이 완전히 동일하지 않은 사실이 문제가 되는 경우가 많다. 아래의 경우를 보자.
	* 수집 작업은 다양한 소스 시스템 유형을 처리할 수 있게 작성한다.
	* 동일한 소스 시스템 유형에 대한 수집 작업은 쉽게 표준화되지 않는다.
* 조직에 따라 사용자가 수집하는 시스템을 거의 제어하지 못할 수 있다. 이유는 아래와 같다. 
	* 첫째 비 기술적 요인이다. - 표준화되어있지 않은 경우.
		* 고맙게도 소프트웨어 엔지니어들은 표준화 작업의 효율성과 유지 관리 측면에서의 이점을 이해한다.
	* 많은 타사 데이터 소스에서 데이터를 수집해야 하는 경우 - 데이터 팀은 작업에 적합하지 않은 제품에서 데이터를 수집해야 할 수 있다. 
		* 평가 과정의 초기단계부터 참여할 수 있도록 최선을 다하고 팀이 함께 최종 결정을 내릴 수 있게 노력하라.
	* 사용자가 제어할 수 있는 몇 가지 기술적 접근 방식을 통해 수집 작업의 복잡성을 줄일 수 있다.
		* 가능한 모든 코드 표준화 및 재사용
		* 구성 기반 데이터 수집 노력
		* 자신의 추상화를 고려

#### 데이터 모델링 로직의 재사용
* 복잡성은 파이프라인 아래(특히 변환 단계)의 모델링 중에 발생할 수 있다. 분석가가 모델을 많이 구축할수록 보이는 두 가지 경향을 보자.
	* 각 모델을 구축하는 SQL에서 로직을 반복한다.
	* 모델을 서로 분리하여 모델 간에 수많은 종속성을 생성한다.
* 코드 재사용은 데이터 모델링에도 이상적이다. 대신 파이프라인에서는 조금 더 복잡한 종속성 그래프를 가지게 된다.
* 예시는 중략(책 193page 참고)
#### 종속성 무결성 보장
* 데이터 모델 로직을 재사용하는 것은 트레이드 오프가 있다. 
* 종속성이 많아지면 모델을 빌드함에 따라 종속성을 추적하는 것이 상당히 어려워진다. (+ 오류 발생율)
* 파이프라인이 복잡해짐에 따라 모델 간의 종속성을 정의하고 검증하기 위한 방식을 고려하기 시작해야 한다.
	1. 개발 프로세스에 몇 가지 로직을 구축하여 SQL 스크립트 종속성을 식별하고 DAG 위의 단계에서 실행되게 한다. 
		* 간단하지 않으며 분석가가 새 모델을 제출할 때나 기존 모델을 수행할 때, 구성 파일에 수동으로 종속성 목록을 제공해야 한다.
	2. dbt와 같은 데이터 모델 개발 프레임워크를 사용하는 것

		SELECT
			obd.order_date,
			ot.order_count
		FROM {{ref('model_1')}} obd
			LEFT JOIN other_table ot
				ON ot.some_date = obd.order_date;

		* 위의 업데이트된 SQL을 통해 SQL(model2)가 model1에 의존한다는 것을 알고 적절한 순서로 실행한다.

* 에어플로우 BashOperator를 사용하여 dbt run 명령을 수행하면 dbt와 함께 에어플로우를 오케스트레이터로 계속 사용할 수도 있다.

* 개발 프로세스에 위의 어떤 방식을 사용하든 종속성을 처리하는 것은 데이터 파이프라인을 유지 관리하는데 주용하다. 
* 가장 중요한 것은 수동 검사와 사람의 눈으로 확인하는 작업을 피하는 것이다.
